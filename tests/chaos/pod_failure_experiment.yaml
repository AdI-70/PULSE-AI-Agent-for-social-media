# Litmus chaos experiment for Pod failure in Pulse
apiVersion: litmuschaos.io/v1alpha1
kind: ChaosEngine
metadata:
  name: pulse-pod-failure
  namespace: pulse
spec:
  appinfo:
    appns: pulse
    applabel: "app=pulse"
    appkind: deployment
  # It can be true/false
  annotationCheck: "false"
  # It can be active/stop
  engineState: "active"
  # Chaos monkey settings
  chaosServiceAccount: pulse-chaos-sa
  monitoring: false
  # It can be delete/retain
  jobCleanUpPolicy: "delete"
  experiments:
    - name: pod-delete
      spec:
        components:
          env:
            # set target pod labels
            - name: TARGET_POD_LABELS
              value: "app=pulse,component in (backend,worker)"

            # pod affected percentage
            - name: PODS_AFFECTED_PERC
              value: "20"
              
            # total chaos duration (in seconds)
            - name: TOTAL_CHAOS_DURATION
              value: "60"

            # chaos interval (in seconds)
            - name: CHAOS_INTERVAL
              value: "30"

            # time duration to wait before injection of chaos in seconds
            - name: RAMP_TIME
              value: "0"

---
apiVersion: litmuschaos.io/v1alpha1
kind: ChaosEngine
metadata:
  name: pulse-pod-network-latency
  namespace: pulse
spec:
  appinfo:
    appns: pulse
    applabel: "app=pulse"
    appkind: deployment
  # It can be true/false
  annotationCheck: "false"
  # It can be active/stop
  engineState: "active"
  # Chaos monkey settings
  chaosServiceAccount: pulse-chaos-sa
  monitoring: false
  # It can be delete/retain
  jobCleanUpPolicy: "delete"
  experiments:
    - name: pod-network-latency
      spec:
        components:
          env:
            # set target pod labels
            - name: TARGET_POD_LABELS
              value: "app=pulse,component in (backend,worker)"

            # network latency (in milliseconds)
            - name: NETWORK_LATENCY
              value: "2000"

            # total chaos duration (in seconds)
            - name: TOTAL_CHAOS_DURATION
              value: "120"

            # container runtime interface (CRI)
            - name: CONTAINER_RUNTIME
              value: "docker"

            # socket path for the CRI
            - name: SOCKET_PATH
              value: "/var/run/docker.sock"